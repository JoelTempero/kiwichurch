<!DOCTYPE html>
<html lang="en-NZ">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>Kete - Kiwi Church | Stories, Reflections & Updates</title>
    <meta name="title" content="Kete - Kiwi Church | Stories, Reflections & Updates">
    <meta name="description" content="Read stories, devotions, and updates from the Kiwi Church community. The Kete is our collection of reflections on faith, life, and community.">
    <meta name="keywords" content="Christian blog, church reflections, faith stories, devotions NZ, church updates Christchurch">
    <meta name="author" content="Kiwi Church">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://kiwichurch.org.nz/kete.html">

    <!-- Theme & App Meta -->
    <meta name="theme-color" content="#1a3a2f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Kiwi Church">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kiwichurch.org.nz/kete.html">
    <meta property="og:title" content="Kete - Kiwi Church">
    <meta property="og:description" content="Stories, devotions, and updates from the Kiwi Church community.">
    <meta property="og:image" content="https://kiwichurch.org.nz/images/og-image.jpg">
    <meta property="og:locale" content="en_NZ">
    <meta property="og:site_name" content="Kiwi Church">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://kiwichurch.org.nz/kete.html">
    <meta name="twitter:title" content="Kete - Kiwi Church">
    <meta name="twitter:description" content="Stories, devotions, and updates from the Kiwi Church community.">
    <meta name="twitter:image" content="https://kiwichurch.org.nz/images/og-image.jpg">

    <!-- Favicon & Icons -->
    <link rel="icon" type="image/png" href="icons/icon-192.png">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="manifest" href="manifest.json">

    <!-- Preconnect & Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400;1,500&family=Nunito+Sans:ital,opsz,wght@0,6..12,300;0,6..12,400;0,6..12,500;0,6..12,600;1,6..12,400&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/styles.css">

    <!-- Structured Data for Blog -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Blog",
        "name": "Kete - Kiwi Church Blog",
        "description": "Stories, devotions, and updates from the Kiwi Church community",
        "url": "https://kiwichurch.org.nz/kete.html",
        "publisher": {
            "@type": "Organization",
            "name": "Kiwi Church",
            "logo": {
                "@type": "ImageObject",
                "url": "https://kiwichurch.org.nz/icons/icon-512.png"
            }
        }
    }
    </script>
</head>
<body>
    <!-- Header -->
    <header class="header scrolled" id="header">
        <div class="header-inner">
            <a href="index.html" class="header-logo">
                <img src="KiwiChurch_Old_White_Shadow.png" alt="Kiwi Church Logo">
            </a>

            <nav class="nav-desktop" id="nav-desktop" aria-label="Main navigation">
                <a href="index.html" class="nav-link">Home</a>
                <a href="about.html" class="nav-link">About</a>
                <a href="communities.html" class="nav-link">Communities</a>
                <a href="calendar.html" class="nav-link">Calendar</a>
                <a href="kete.html" class="nav-link active">Kete</a>
                <a href="resources.html" class="nav-link">Resources</a>
                
                <a href="portal.html" class="btn btn-outline">Portal</a>
            </nav>

            <button class="mobile-menu-btn" id="mobile-menu-btn" onclick="toggleMobileMenu()" aria-label="Toggle mobile menu">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"></line>
                    <line x1="3" y1="12" x2="21" y2="12"></line>
                    <line x1="3" y1="18" x2="21" y2="18"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Mobile Navigation -->
    <nav class="mobile-nav" id="mobile-nav" aria-label="Mobile navigation">
        <a href="index.html" class="mobile-nav-link">Home</a>
        <a href="about.html" class="mobile-nav-link">About</a>
        <a href="communities.html" class="mobile-nav-link">Communities</a>
        <a href="calendar.html" class="mobile-nav-link">Calendar</a>
        <a href="kete.html" class="mobile-nav-link">Kete</a>
        <a href="resources.html" class="mobile-nav-link">Resources</a>
        
        <a href="portal.html" class="mobile-nav-link">Member Portal</a>
    </nav>

    <!-- Main Content -->
    <main id="main">
        <!-- Hero Section -->
        <section class="about-hero" aria-labelledby="kete-heading">
            <div class="about-hero-content">
                <h1 id="kete-heading">The Kete</h1>
                <p>Stories, reflections, and updates from our community</p>
            </div>
        </section>

        <!-- What is the Kete? -->
        <section class="section section-sm" aria-labelledby="about-kete">
            <div class="container-sm" style="text-align: center;">
                <p style="font-size: 1.125rem; color: var(--color-text-light);" id="about-kete">
                    In Te Reo Maori, a <em>kete</em> is a woven basket used to carry treasures. This is our kete - a collection of writings, reflections, and updates we want to share with you.
                </p>
            </div>
        </section>

        <!-- Search and Filter -->
        <section class="section section-sm" style="padding-bottom: 0;">
            <div class="container">
                <div style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: center;">
                    <div style="flex: 1; min-width: 250px;">
                        <input type="text" id="kete-search" placeholder="Search posts..." style="width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--color-cream-dark); border-radius: var(--radius-md); font-size: 1rem;" oninput="filterPosts()">
                    </div>
                    <div id="category-filters" style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Blog Posts -->
        <section class="section" aria-labelledby="posts-heading">
            <div class="container">
                <h2 class="sr-only" id="posts-heading">All Posts</h2>
                <p id="posts-count" style="color: var(--color-text-light); margin-bottom: 1.5rem;"></p>
                <div class="blog-grid" id="kete-posts">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </section>
    </main>

    <!-- Post Modal -->
    <div id="post-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
            <button class="modal-close" onclick="closePostModal()" aria-label="Close modal">&times;</button>
            <div id="post-modal-content">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-brand">
                <img src="KiwiChurch_Old_White_Shadow.png" alt="Kiwi Church">
                <p>A network of small group Christian communities in Christchurch, New Zealand.</p>
            </div>
            <div class="footer-nav">
                <h4 class="footer-title">Explore</h4>
                <ul class="footer-links">
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="communities.html">Communities</a></li>
                    <li><a href="calendar.html">Calendar</a></li>
                    <li><a href="kete.html">Kete</a></li>
                </ul>
            </div>
            <div class="footer-nav">
                <h4 class="footer-title">Connect</h4>
                <ul class="footer-links">
                    <li><a href="resources.html">Resources</a></li>
                    
                    <li><a href="portal.html">Member Portal</a></li>
                </ul>
            </div>
            <div class="footer-contact-section">
                <h4 class="footer-title">Contact</h4>
                <div class="footer-contact">
                    <p>Christchurch, New Zealand</p>
                    <p><a href="mailto:hello@kiwichurch.org.nz">hello@kiwichurch.org.nz</a></p>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Kiwi Church. All rights reserved.</p>
        </div>
    </footer>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container" aria-live="polite"></div>

    <!-- Scripts -->
    <script src="js/main.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js';
        import { getFirestore, collection, getDocs, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js';

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyAd1I0cDraUbABCKX3JMxmtW6lPxvvdFv8",
            authDomain: "kiwi-church.firebaseapp.com",
            projectId: "kiwi-church",
            storageBucket: "kiwi-church.firebasestorage.app",
            messagingSenderId: "773909055908",
            appId: "1:773909055908:web:dca65e7e1c4fd26a0ee93f"
        };

        // Fallback posts (used if Firebase unavailable)
        const fallbackPosts = [
            {
                id: 'finding-sacred',
                title: 'Finding Sacred in the Ordinary',
                excerpt: 'Reflections on discovering God in everyday moments and mundane routines.',
                content: `There's a moment each morning, somewhere between the first sip of coffee and the rush of the day, where I find myself pausing. It's not a grand spiritual practice—just a breath, a noticing.

I've been learning that God doesn't only show up in the mountain-top experiences or the carefully crafted worship services. Sometimes the sacred sneaks in through the back door: in the steam rising from a cup, in the sound of rain on the roof, in the mundane rhythm of washing dishes.

Brother Lawrence called it "practicing the presence of God." I'm calling it "paying attention."

What if our everyday moments—the commute, the grocery run, the bedtime routine—are all invitations to encounter? What if the ordinary is already holy, and we just need eyes to see?

This week, I'm trying something simple: before I rush into each task, I'll take one breath and ask, "Where are you here, God?"

Maybe you'd like to try it too.`,
                publishedAt: '2024-01-10',
                authorName: 'Darryl Tempero',
                category: 'reflection'
            },
            {
                id: 'winter-update',
                title: 'Community Update: Summer 2024',
                excerpt: 'A look back at what God has been doing in our communities over the past season.',
                content: `As we head into the new year, we wanted to take a moment to celebrate what God has been doing in our communities over the summer.

## Thin Place
Our fortnightly gatherings have continued to be a space of deep encounter and honest conversation. We've welcomed several new faces and have been moved by the stories shared around our tables.

## Prestons Community
The Friday night dinners have become a highlight for many families. There's something beautiful about sharing a meal together, watching the kids play, and simply being present with one another.

## Rito Shack
Our creative gathering has been exploring new ways of expressing faith through art. Last month's collaborative painting project was a powerful reminder that we're all part of something bigger.

## Looking Ahead
As we move into 2024, we're excited about what's to come. We're dreaming about new ways to serve our neighborhoods and deepen our connections with one another.

Thank you for being part of this community. You belong here.`,
                publishedAt: '2024-01-03',
                authorName: 'Kiwi Church Team',
                category: 'update'
            },
            {
                id: 'art-of-showing-up',
                title: 'The Art of Showing Up',
                excerpt: 'Why consistent presence matters more than perfect attendance.',
                content: `I used to think that being part of a community meant never missing a gathering. That good members showed up every single time, fully present and engaged.

But life doesn't work that way, does it?

There are seasons when we're overwhelmed, when the kids are sick, when work is demanding, when we simply don't have the energy. And in those moments, I've learned something important: **showing up doesn't have to be perfect to be meaningful**.

Sometimes showing up means dragging yourself to the gathering even when you'd rather stay home. Other times, it means sending a text to say "I'm thinking of you" when you can't be there in person. And sometimes, it means receiving grace when you've been absent for weeks.

Community isn't built on perfect attendance. It's built on consistent presence over time—the kind that weathers the ups and downs, the busy seasons and the quiet ones.

So if you've been away for a while, know this: you're still part of us. And when you're ready, there's always a seat at the table with your name on it.`,
                publishedAt: '2023-12-20',
                authorName: 'Sarah Utting',
                category: 'reflection'
            }
        ];

        let posts = fallbackPosts;
        let selectedCategory = null;
        let searchQuery = '';

        // Category definitions
        const categories = {
            'reflection': { name: 'Reflection', color: '#1a3a2f' },
            'update': { name: 'Update', color: '#c17f59' },
            'teaching': { name: 'Teaching', color: '#7d9a87' },
            'devotion': { name: 'Devotion', color: '#d4a574' },
            'story': { name: 'Story', color: '#5a6b62' }
        };

        // Calculate reading time
        function calculateReadingTime(content) {
            const wordsPerMinute = 200;
            const words = content?.split(/\s+/).length || 0;
            return Math.max(1, Math.ceil(words / wordsPerMinute));
        }

        // Load from Firebase
        async function loadFromFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const q = query(
                    collection(db, 'kete'),
                    where('published', '==', true),
                    orderBy('publishedAt', 'desc')
                );
                const querySnapshot = await getDocs(q);

                if (!querySnapshot.empty) {
                    const firebasePosts = [];
                    querySnapshot.forEach((doc) => {
                        firebasePosts.push({ id: doc.id, ...doc.data() });
                    });
                    posts = firebasePosts;
                }
            } catch (error) {
                console.log('Using fallback data:', error.message);
            }
            renderCategoryFilters();
            renderPosts();
        }

        // Render category filter buttons
        function renderCategoryFilters() {
            const container = document.getElementById('category-filters');
            if (!container) return;

            const usedCategories = [...new Set(posts.map(p => p.category).filter(Boolean))];

            container.innerHTML = `
                <button onclick="window.setCategory(null)" class="btn btn-sm ${!selectedCategory ? 'btn-primary' : 'btn-ghost'}" style="border-radius: 999px;">All</button>
                ${usedCategories.map(catId => {
                    const cat = categories[catId] || { name: catId, color: '#666' };
                    const isActive = selectedCategory === catId;
                    return `<button onclick="window.setCategory('${catId}')" class="btn btn-sm ${isActive ? 'btn-primary' : 'btn-ghost'}" style="border-radius: 999px; ${isActive ? `background: ${cat.color}; border-color: ${cat.color};` : ''}">${cat.name}</button>`;
                }).join('')}
            `;
        }

        // Filter posts
        window.filterPosts = function() {
            searchQuery = document.getElementById('kete-search')?.value?.toLowerCase() || '';
            renderPosts();
        };

        // Set category filter
        window.setCategory = function(category) {
            selectedCategory = category;
            renderCategoryFilters();
            renderPosts();
        };

        // Render posts
        function renderPosts() {
            const container = document.getElementById('kete-posts');
            const countEl = document.getElementById('posts-count');
            if (!container) return;

            // Filter posts
            let filteredPosts = posts;
            if (selectedCategory) {
                filteredPosts = filteredPosts.filter(p => p.category === selectedCategory);
            }
            if (searchQuery) {
                filteredPosts = filteredPosts.filter(p =>
                    p.title?.toLowerCase().includes(searchQuery) ||
                    p.excerpt?.toLowerCase().includes(searchQuery) ||
                    p.authorName?.toLowerCase().includes(searchQuery)
                );
            }

            if (countEl) {
                countEl.textContent = `${filteredPosts.length} post${filteredPosts.length !== 1 ? 's' : ''}`;
            }

            if (filteredPosts.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--color-text-light);">
                        <p>No posts found matching your search.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filteredPosts.map(post => {
                const date = new Date(post.publishedAt || post.date);
                const formattedDate = date.toLocaleDateString('en-NZ', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                const readingTime = calculateReadingTime(post.content);
                const cat = categories[post.category] || { name: post.category || 'Post', color: '#666' };

                return `
                    <article class="blog-card" id="${post.id}">
                        <div class="blog-card-image" style="display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, ${cat.color} 0%, ${cat.color}cc 100%);">
                            <span style="color: var(--color-white); font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.9;">${cat.name}</span>
                        </div>
                        <div class="blog-card-content">
                            <span class="blog-card-date">${formattedDate} &bull; ${post.authorName || 'Kiwi Church'}</span>
                            <h3 class="blog-card-title">${post.title}</h3>
                            <p class="blog-card-excerpt">${post.excerpt}</p>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: auto;">
                                <span style="font-size: 0.875rem; color: var(--color-sage);">${readingTime} min read</span>
                                <button class="btn btn-ghost btn-sm" onclick="window.viewPost('${post.id}')">Read More</button>
                            </div>
                        </div>
                    </article>
                `;
            }).join('');
        }

        // View post in modal
        window.viewPost = function(postId) {
            const post = posts.find(p => p.id === postId);
            if (!post) return;

            const modal = document.getElementById('post-modal');
            const content = document.getElementById('post-modal-content');
            if (!modal || !content) return;

            const date = new Date(post.publishedAt || post.date);
            const formattedDate = date.toLocaleDateString('en-NZ', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            const readingTime = calculateReadingTime(post.content);
            const cat = categories[post.category] || { name: post.category || 'Post', color: '#666' };

            // Convert markdown-like formatting to HTML
            let htmlContent = (post.content || '')
                .replace(/^## (.+)$/gm, '<h3>$1</h3>')
                .replace(/^# (.+)$/gm, '<h2>$1</h2>')
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.+?)\*/g, '<em>$1</em>')
                .replace(/\n\n/g, '</p><p>')
                .replace(/\n/g, '<br>');
            htmlContent = '<p>' + htmlContent + '</p>';

            content.innerHTML = `
                <article style="padding: 1rem;">
                    <div style="margin-bottom: 1.5rem;">
                        <span style="background: ${cat.color}; color: white; padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.75rem; text-transform: uppercase;">${cat.name}</span>
                    </div>
                    <h1 style="font-family: var(--font-display); font-size: 2rem; color: var(--color-forest); margin: 0 0 1rem;">${post.title}</h1>
                    <div style="display: flex; gap: 1rem; align-items: center; color: var(--color-text-light); font-size: 0.9375rem; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--color-cream-dark);">
                        <span>${post.authorName || 'Kiwi Church'}</span>
                        <span>&bull;</span>
                        <span>${formattedDate}</span>
                        <span>&bull;</span>
                        <span>${readingTime} min read</span>
                    </div>
                    <div style="font-size: 1.0625rem; line-height: 1.8; color: var(--color-text);">
                        ${htmlContent}
                    </div>
                </article>
            `;

            modal.classList.add('open');
            document.body.style.overflow = 'hidden';
        };

        // Close post modal
        window.closePostModal = function() {
            const modal = document.getElementById('post-modal');
            if (modal) {
                modal.classList.remove('open');
                document.body.style.overflow = '';
            }
        };

        // Close modal on backdrop click
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) {
                window.closePostModal();
            }
        });

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                window.closePostModal();
            }
        });

        // Load on page ready
        document.addEventListener('DOMContentLoaded', loadFromFirebase);
    </script>
</body>
</html>
